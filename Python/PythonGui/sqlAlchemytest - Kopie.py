import sqlalchemy as adb
import pandas as pd

def sqlconnect(serverName: str, databaseName: str, user: str, password: str):
    """sql connection method"""

    #params = urllib.parse.quote_plus('DRIVER={ODBC Driver 17 for SQL Server};SERVER='+serverName+';DATABASE='+databaseName+';UID='+user+';PWD='+password)
    driver = "SQL Server"
    
    url = adb.URL.create(
        "mssql+pyodbc",
        username=user,
        password=password,
        database=databaseName,
        host=serverName,
        query={"driver": driver},
        )
    
    #engine = adb.create_engine("mssql+pyodbc:///?odbc_connect=%s" % params)
    engine = adb.create_engine(url)
    return engine

sn = r"SURCONSTORAGE\MUSTERTRAINING"
dn = r'SIS_MasterTraining_HotStripMill_Test'
user = r'sa'
pw = r'admin4SQLServer'

engine = sqlconnect(sn, dn, user, pw)
conn = engine.connect()
if not conn.closed:
    print('connected')

query = (""" 
        SELECT D.[GaugeID], 
                D.[DefectMapID], 
                D.[DefectID],
                D.[CameraID]
            ,D.[ImageID]
            ,[ClassID] as KlasseSoll
            ,[ClassTest] as KlasseIst
            ,[DefectStatus]
            ,[Feature0]
            ,[Feature1]
            ,[Feature2]
            ,[Feature3]
            ,[Feature4]
            ,[Feature5]
            ,[Feature6]
            ,[Feature7]
            ,[Feature8]
            ,[Feature9]
            ,[Feature10]
            ,[Feature11]
            ,[Feature12]
            ,[Feature13]
            ,[Feature14]
            ,[Feature15]
            ,[Feature16]
            ,[Feature17]
            ,[Feature18]
            ,[Feature19]
            ,[Feature20]
            ,[Feature21]
            ,[Feature22]
            ,[Feature23]
            ,[Feature24]
            ,[Feature25]
            ,[Feature26]
            ,[Feature27]
            ,[Feature28]
            ,[Feature29]
            ,[Feature30]
            ,[Feature31]
            ,[Feature32]
            ,[Feature33]
            ,[Feature34]
            ,[Feature35]
            ,[Feature36]
            ,[Feature37]
            ,[Feature38]
            ,[Feature39]
            ,[Feature40]
            ,[Feature41]
            ,[Feature42]
            ,[Feature43]
            ,[Feature44]
            ,[Feature45]
            ,[Feature46]
            ,[Feature47]
            ,[Feature48]
            ,[Feature49]
            ,[Feature50]
            ,[Feature51]
            ,[Feature52]
            ,[Feature53]
            ,[Feature54]
            ,[Feature55]
            ,[Feature56]
            ,[Feature57]
            ,[Feature58]
            ,[Feature59]
            ,[Feature60]
            ,[Feature61]
            ,[Feature62]
            ,[Feature63]
            ,[Feature64]
            ,[Feature65]
            ,[Feature66]
            ,[Feature67]
            ,[Feature68]
            ,[Feature69]
            ,[Feature70]
            ,[Feature71]
            ,[Feature72]
            ,[Feature73]
            ,[Feature74]
            ,[Feature75]
            ,[Feature76]
            ,[Feature77]
            ,[Feature78]
            ,[Feature79]
            ,[Feature80]
            ,[Feature81]
            ,[Feature82]
            ,[Feature83]
            ,[Feature84]
            ,[Feature85]
            ,[Feature86]
            ,[Feature87]
            ,[Feature88]
            ,[Feature89]
            ,[Feature90]
            ,[Feature91]
            ,[Feature92]
            ,[Feature93]
            ,[Feature94]
            ,[Feature95]
            ,[Feature96]
            ,[Feature97]
            ,[Feature98]
            ,[Feature99]
            ,[Feature100]
            ,[Feature101]
            ,[Feature102]
            ,[Feature103]
            ,[Feature104]
            ,[Feature105]
            ,[Feature106]
            ,[Feature107]
            ,[Feature108]
            ,[Feature109]
            ,[Feature110]
            ,[Feature111]
            ,[Feature112]
            ,[Feature113]
            ,[Feature114]
            ,[Feature115]
            ,[Feature116]
            ,[Feature117]
            ,[Feature118]
            ,[Feature119]
            ,[Feature120]
            ,[Feature121]
            ,[Feature122]
            ,[Feature123]
            ,[Feature124]
            ,[Feature125]
            ,[Feature126]
            ,[Feature127]
            ,[Feature128]
            ,[Feature129]
            ,[Feature130]
            ,[Feature131]
            ,[Feature132]
            ,[Feature133]
            ,[Feature134]
            ,[Feature135]
            ,[Feature136]
            ,[Feature137]
            ,[Feature138]
            ,[Feature139]
            ,[Feature140]
            ,[Feature141]
            ,[Feature142]
            ,[Feature143]
            ,[Feature144]
            ,[Feature145]
            ,[Feature146]
            ,[Feature147]
            ,[Feature148]
            ,[Feature149]
            ,[Feature150]
            ,[Feature151]
            ,[Feature152]
            ,[Feature153]
            ,[Feature154]
            ,[Feature155]
            ,[Feature156]
            ,[Feature157]
            ,[Feature158]
            ,[Feature159]
            ,[Feature160]
            ,[Feature161]
            ,[Feature162]
            ,[Feature163]
            ,[Feature164]
            ,[Feature165]
            ,[Feature166]
            ,[Feature167]
            ,[Feature168]
            ,[Feature169]
            ,[Feature170]
            ,[Feature171]
            ,[Feature172]
            ,[Feature173]
            ,[Feature174]
            ,[Feature175]
            ,[Feature176]
            ,[Feature177]
            ,[Feature178]
            ,[Feature179]
            ,[Feature180]
            ,[Feature181]
            ,[Feature182]
            ,[Feature183]
            ,[Feature184]
            ,[Feature185]
            ,[Feature186]
            ,[Feature187]
            ,[Feature188]
            ,[Feature189]
            ,[Feature190]
            ,[Feature191]
            ,[Feature192]
            ,[Feature193]
            ,[Feature194]
            ,[Feature195]
            ,[Feature196]
            ,[Feature197]
            ,[Feature198]
            ,[Feature199]
            ,[Feature200]
            ,[Feature201]
            ,[Feature202]
            ,[Feature203]
            ,[Feature204]
            ,[Feature205]
            ,[Feature206]
            ,[Feature207]
            ,[Feature208]
            ,[Feature209]
            ,[Feature210]
            ,[Feature211]
            ,[Feature212]
            ,[Feature213]
            ,[Feature214]
            ,[Feature215]
            ,[Feature216]
            ,[Feature217]
            ,[Feature218]
            ,[Feature219]
            ,[Feature220]
            ,[Feature221]
            ,[Feature222]
            ,[Feature223]
            ,[Feature224]
            ,[Feature225]
            ,[Feature226]
            ,[Feature227]
            ,[Feature228]
            ,[Feature229]
            ,[Feature230]
            ,[Feature231]
            ,[Feature232]
            ,[Feature233]
            ,[Feature234]
            ,[Feature235]
            ,[Feature236]
            ,[Feature237]
            ,[Feature238]
            ,[Feature239]
            ,[Feature240]
            ,[Feature241]
            ,[Feature242]
            ,[Feature243]
            ,[Feature244]
            ,[Feature245]
            ,[Feature246]
            ,[Feature247]
            ,[Feature248]
            ,[Feature249]
            ,[Feature250]
            ,[Feature251]
            ,[Feature252]
            ,[Feature253]
            ,[Feature254]
            ,[Feature255]
            ,[Feature256]
            ,[Feature257]
            ,[Feature258]
            ,[Feature259]
            ,[Feature260]
            ,[Feature261]
            ,[Feature262]
            ,[Feature263]
            ,[Feature264]
            ,[Feature265]
            ,[Feature266]
            ,[Feature267]
            ,[Feature268]
            ,[Feature269]
            ,[Feature270]
            ,[Feature271]
            ,[Feature272]
            ,[Feature273]
            ,[Feature274]
            ,[Feature275]
            ,[Feature276]
            ,[Feature277]
            ,[Feature278]
            ,[Feature279]
            ,[Feature280]
            ,[Feature281]
            ,[Feature282]
            ,[Feature283]
            ,[Feature284]
            ,[Feature285]
            ,[Feature286]
            ,[Feature287]
            ,[Feature288]
            ,[Feature289]
            ,[Feature290]
            ,[Feature291]
            ,[Feature292]
            ,[Feature293]
            ,[Feature294]
            ,[Feature295]
            ,[Feature296]
            ,[Feature297]
            ,[Feature298]
            ,[Feature299]
            ,[Feature300]
            ,[Feature301]
            ,[Feature302]
            ,[Feature303]
            ,[Feature304]
            ,[Feature305]
            ,[Feature306]
            ,[Feature307]
            ,[Feature308]
            ,[Feature309]
            ,[Feature310]
            ,[Feature311]
            ,[Feature312]
            ,[Feature313]
            ,[Feature314]
            ,[Feature315]
            ,[Feature316]
            ,[Feature317]
            ,[Feature318]
            ,[Feature319]
            ,[Feature320]
            ,[Feature321]
            ,[Feature322]
            ,[Feature323]
            ,[Feature324]
            ,[Feature325]
            ,[Feature326]
            ,[Feature327]
            ,[Feature328]
            ,[Feature329]
            ,[Feature330]
            ,[Feature331]
            ,[Feature332]
            ,[Feature333]
            ,[Feature334]
            ,[Feature335]
            ,[Feature336]
            ,[Feature337]
            ,[Feature338]
            ,[Feature339]
            ,[Feature340]
            ,[Feature341]
            ,[Feature342]
            ,[Feature343]
            ,[Feature344]
            ,[Feature345]
            ,[Feature346]
            ,[Feature347]
            ,[Feature348]
            ,[Feature349]
            ,[Feature350]
            ,[Feature351]
            ,[Feature352]
            ,[Feature353]
            ,[Feature354]
            ,[Feature355]
            ,[Feature356]
            ,[Feature357]
            ,[Feature358]
            ,[Feature359]
            ,[Feature360]
            ,[Feature361]
            ,[Feature362]
            ,[Feature363]
            ,[Feature364]
            ,[Feature365]
            ,[Feature366]
            ,[Feature367]
            ,[Feature368]
            ,[Feature369]
            ,[Feature370]
            ,[Feature371]
            ,[Feature372]
            ,[Feature373]
            ,[Feature374]
            ,[Feature375]
            ,[Feature376]
            ,[Feature377]
            ,[Feature378]
            ,[Feature379]
            ,[Feature380]
            ,[Feature381]
            ,[Feature382]
            ,[Feature383]
            ,[Feature384]
            ,[Feature385]
            ,[Feature386]
            ,[Feature387]
            ,[Feature388]
            ,[Feature389]
            ,[Feature390]
            ,[Feature391]
            ,[Feature392]
            ,[Feature393]
            ,[Feature394]
            ,[Feature395]
            ,[Feature396]
            ,[Feature397]
            ,[Feature398]
            ,[Feature399]
            ,[Feature400]
            ,[Feature401]
            ,[Feature402]
            ,[Feature403]
            ,[Feature404]
            ,[Feature405]
            ,[Feature406]
            ,[Feature407]
            ,[Feature408]
            ,[Feature409]
            ,[Feature410]
            ,[Feature411]
            ,[Feature412]
            ,[Feature413]
            ,[Feature414]
            ,[Feature415]
            ,[Feature416]
            ,[Feature417]
            ,[Feature418]
            ,[Feature419]
            ,[Feature420]
            ,[Feature421]
            ,[Feature422]
            ,[Feature423]
            ,[Feature424]
            ,[Feature425]
            ,[Feature426]
            ,[Feature427]
            ,[Feature428]
            ,[Feature429]
            ,[Feature430]
            ,[Feature431]
            ,[Feature432]
            ,[Feature433]
            ,[Feature434]
            ,[Feature435]
            ,[Feature436]
            ,[Feature437]
            ,[Feature438]
            ,[Feature439]
            ,[Feature440]
            ,[Feature441]
            ,[Feature442]
            ,[Feature443]
            ,[Feature444]
            ,[Feature445]
            ,[Feature446]
            ,[Feature447]
            ,[Feature448]
            ,[Feature449]
            ,[Feature450]
            ,[Feature451]
            ,[Feature452]
            ,[Feature453]
            ,[Feature454]
            ,[Feature455]
            ,[Feature456]
            ,[Feature457]
            ,[Feature458]
            ,[Feature459]
            ,[Feature460]
            ,[Feature461]
            ,[Feature462]
            ,[Feature463]
            ,[Feature464]
            ,[Feature465]
            ,[Feature466]
            ,[Feature467]
            ,[Feature468]
            ,[Feature469]
            ,[Feature470]
            ,[Feature471]
            ,[Feature472]
            ,[Feature473]
            ,[Feature474]
            ,[Feature475]
            ,[Feature476]
            ,[Feature477]
            ,[Feature478]
            ,[Feature479]
            ,[Feature480]
            ,[Feature481]
            ,[Feature482]
            ,[Feature483]
            ,[Feature484]
            ,[Feature485]
            ,[Feature486]
            ,[Feature487]
            ,[Feature488]
            ,[Feature489]
            ,[Feature490]
            ,[Feature491]
            ,[Feature492]
            ,[Feature493]
            ,[Feature494]
            ,[Feature495]
            ,[Feature496]
            ,[Feature497]
            ,[Feature498]
            ,[LabelErrorScore]
        FROM [dbo].[Defect] as D INNER JOIN [dbo].[FeatureVector] as F ON (D.GaugeID = F.GaugeID AND D.DefectMapID = F.DefectMapID AND D.DefectID = F.DefectID) 
        """)
df=pd.read_sql(query, conn)

#value_var = "value"
#index_var = "index"
#if df.loc[["GaugeID", "DefectMapID", "DefectID"], index_var] == df2.loc[["GaugeID", "DefectMapID", "DefectID"], index_var]:
#    df.at[508, index_var] = value_var

conn.close()

#df.to_csv("Test12.csv", sep=',', index=False, header=False)
#print(df)